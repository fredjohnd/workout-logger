
<div *ngIf="workout">
  <app-workout-header-navigation
  [model]="workout"
  class="text-center"
  (startTimeUpdate)="this.updateWorkoutStartDate()"
  >
  <mat-menu #appMenu="matMenu" yPosition="below">
    <!-- Add category button -->
    <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-menu-item (click)="this.onShowCategoryPicker()">
      <span>
        <mat-icon svgIcon="list-add" aria-label="Add category">add category</mat-icon>
        <span>Add Category</span>
      </span>
    </button>

    <!-- Change start time button -->
    <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-menu-item (click)="this.updateWorkoutStartDate()">
      <span>
        <mat-icon svgIcon="timer-on" aria-label="Finish workout">change start time</mat-icon>
        <span>Change start time</span>
      </span>
    </button>

    <!-- Finish workout button -->
    <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-menu-item (click)="this.finishWorkout()">
      <span>
        <mat-icon svgIcon="timer-off" aria-label="Finish workout">finish workout</mat-icon>
        <span>Finish workout</span>
      </span>
    </button>

    <!-- Save workout button -->
    <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-menu-item (click)="this.saveWorkout()">
      <span>
        <mat-icon svgIcon="save" aria-label="Save Workout">save</mat-icon>
        <span>Save Workout</span>
      </span>
    </button>

    <!-- Delete workout button -->
    <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-menu-item (click)="this.deleteWorkout()">
      <span>
        <mat-icon svgIcon="delete" aria-label="Delete Workout">delete</mat-icon>
        <span>Delete Workout</span>
      </span>
    </button>
  </mat-menu>

  <button mat-icon-button [matMenuTriggerFor]="appMenu">
    <mat-icon>more_vert</mat-icon>
  </button>

</app-workout-header-navigation>

</div>

<div class="row">
  <div *ngIf="workout?.plan.length > 0" class="col-12 workout-wrapper">

    <div class="category-entry mb-2 shadow bg-white rounded" *ngFor="let category of workout.plan; let categoryIndex = index">

      <mat-accordion>
        <mat-expansion-panel [expanded]="true">
          <mat-expansion-panel-header class="pl-0" [collapsedHeight]="'48px'" [expandedHeight]="'48px'">
            <mat-panel-title>
              <div class="col-10 d-flex align-items-center">
                <h5 class="d-flex align-items-center category-header">
                  <span class="d-flex align-items-center ml-2 mr-2">{{this.getCategoryNameById(category.category)}}</span>
                </h5>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>



          <ul class="exercise-list pl-0 ml-0 mt-2">

            <ng-container *ngIf="category.exercises.length; else addExerciseMessage">
            <li class="exercise-entry mb-2 pt-2" *ngFor="let exercise of category.exercises; let exerciseIndex = index; trackBy:indexTracker;">

              <div class="row d-flex align-items-baseline border bg-light position-relative exercise-entry-contents">

                <div class="d-flex col-12 align-items-center mt-2">
                  <span class="exercise-title">{{this.getExerciseNameById(exercise.exercise)}}</span>
                </div>

                <div class="col-12 col-md-10">
                  <div class="row d-flex align-items-baseline ">
                    <div class="col-12">
                      <div class="row pb-2">

                        <ng-container *ngIf="exercise.values.length > 0; else addValueMessage">
                          <mat-form-field class="col-4 col-md-3" *ngFor="let value of exercise.values; let valueIndex = index; trackBy:exerciseTracker">
                            <input matInput class="mr-2" [value]="value" (blur)="this.updateValue(categoryIndex, exerciseIndex, valueIndex, $event.target.value)">

                            <div class="form-field-actions">

                              <button class="mat-button mat-button-focus-actions button-delete-value pl-0 pr-0" (click)="this.deleteExerciseValue(exercise, valueIndex)">
                                <mat-icon svgIcon="delete" aria-label="delete">delete set</mat-icon>
                              </button>
                              <button class="mat-button mat-button-focus-actions button-copy-value pl-0 pr-0" (click)="this.addExerciseValue(exercise, value)">
                                <mat-icon svgIcon="arrow-right" aria-label="Add set">copy exercise set</mat-icon>
                              </button>
                            </div>

                          </mat-form-field>
                        </ng-container>
                        <ng-template #addValueMessage>
                          <span class="add-value-msg mt-2 ml-3">No values for this exercise yet</span>
                        </ng-template>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-12 col-md-2 text-right d-flex flex-nowrap exercise-actions mb-2">
                  <button mat-raised-button color="basic" (click)="this.addExerciseValue(exercise)">Add</button>
                  <mat-menu #exerciseActions="matMenu" yPosition="below">
                    <button mat-menu-item (click)="this.deleteExercise(categoryIndex, exerciseIndex)">Delete</button>
                  </mat-menu>
                  <button mat-icon-button [matMenuTriggerFor]="exerciseActions">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                </div>

              </div>
              <!-- /row -->

            </li>
          </ng-container>
          <ng-template #addExerciseMessage>
              <span class="add-value-msg d-block mt-3">No exercises for this category yet</span>
            </ng-template>
          </ul>
          <button mat-raised-button color="primary" (click)="this.onShowExercisePicker(category)" class="mb-2">Add Exercise</button>
          <button mat-button [disabled]="category.exercises.length > 0" (click)="this.deleteCategory(categoryIndex)">Delete</button>
        </mat-expansion-panel>

      </mat-accordion>
    </div>

    <mat-divider></mat-divider>

  </div>

  <!-- End Category -->


  <footer class="fixed-bottom col-12 pl-0 pr-0 d-none d-lg-block .d-xl-block">
    <mat-toolbar color="primary">
      <mat-toolbar-row>
        <div class="d-flex">

          <!-- Add category button -->
          <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-button (click)="this.onShowCategoryPicker()">
            <span>
              <mat-icon svgIcon="list-add" aria-label="Add category">add category</mat-icon>
              <span>Add Category</span>
            </span>
          </button>

          <!-- Save workout button -->
          <button class="d-flex align-items-center flex-grow-0 flex-shrink-1" mat-button (click)="this.saveWorkout()">
            <span>
              <mat-icon svgIcon="save" aria-label="Save Workout">save</mat-icon>
              <span>Save Workout</span>
            </span>
          </button>

        </div>
      </mat-toolbar-row>
    </mat-toolbar>
  </footer>

</div>
